<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šå½©å†’é™©å¤§è½¬ç›˜ | Colorful Adventure Wheel</title>
    <style>
        :root {
            /* é©¬å¡é¾™è‰²ç³» */
            --c-pink: #FFC3C3;
            --c-blue: #A0E7E5;
            --c-yellow: #FBE7C6;
            --c-green: #B4F8C8;
            --c-purple: #E0BBE4;
            --c-text: #555;
            --c-bg: #F9F9F9;
            --c-primary: #FF9AA2;
            --c-primary-hover: #FFB7B2;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--c-bg);
            color: var(--c-text);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        header {
            background: white;
            padding: 10px 20px;
            box-shadow: var(--shadow);
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 1.2rem; color: var(--c-primary); }

        .lang-switch {
            cursor: pointer;
            padding: 5px 12px;
            border: 2px solid var(--c-primary);
            border-radius: 20px;
            color: var(--c-primary);
            font-weight: bold;
            transition: all 0.3s;
        }
        .lang-switch:hover { background: var(--c-primary); color: white; }

        /* ä¸»å¸ƒå±€ */
        main {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* å·¦ä¾§ï¼šæ´»åŠ¨ç®¡ç† */
        .sidebar {
            width: 350px;
            background: white;
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            z-index: 5;
        }

        .category-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 8px 0;
            border: none;
            background: #eee;
            cursor: pointer;
            border-radius: 8px;
            font-size: 0.8rem;
            transition: 0.3s;
        }
        .tab-btn.active { background: var(--c-primary); color: white; }

        .add-box {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }
        .add-box input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .add-box button {
            padding: 0 15px;
            background: var(--c-green);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: #444;
        }

        .activity-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #fdfdfd;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
        }

        .activity-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.06);
        }

        .activity-item.selected {
            border-color: var(--c-primary);
            background: #FFF0F1;
        }

        .item-check {
            width: 18px;
            height: 18px;
            border: 2px solid #ccc;
            border-radius: 4px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .activity-item.selected .item-check {
            background: var(--c-primary);
            border-color: var(--c-primary);
        }
        .activity-item.selected .item-check::after {
            content: 'âœ”';
            color: white;
            font-size: 12px;
        }
        .selection-count {
            margin-top: 10px;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
        }

        /* ä¸­é—´ï¼šè½¬ç›˜åŒºåŸŸ */
        .wheel-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle at center, #fff 0%, #f0f0f0 100%);
        }

        .canvas-wrapper {
            position: relative;
            width: 80vmin;
            height: 80vmin;
            max-width: 500px;
            max-height: 500px;
            margin-bottom: 30px;
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            transition: transform 0s; /* åŠ¨ç”»ç”±JSæ§åˆ¶ */
        }

        /* æŒ‡é’ˆ SVG */
        .pointer {
            position: absolute;
            top: -30px; /* è½»å¾®é‡å  */
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            z-index: 20;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
        }

        .center-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            border: 4px solid var(--c-primary);
            font-weight: bold;
            color: var(--c-primary);
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        .spin-btn-lg {
            padding: 15px 50px;
            border-radius: 30px;
            border: none;
            background: linear-gradient(45deg, var(--c-primary), var(--c-primary-hover));
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 154, 162, 0.4);
            transition: all 0.3s;
        }
        .spin-btn-lg:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .spin-btn-lg:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 154, 162, 0.6);
        }

        .status-text {
            position: absolute;
            top: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--c-primary);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .status-text.show { opacity: 1; }

        /* ç»“æœå¡ç‰‡ */
        .result-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        .result-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .result-card {
            background: white;
            width: 340px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            text-align: center;
            transform: scale(0.8);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-top: 10px solid var(--c-purple);
        }
        .result-overlay.active .result-card {
            transform: scale(1);
        }

        .result-tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            color: white;
            font-size: 0.8rem;
            margin-bottom: 15px;
            background: #ccc;
        }
        .result-title { font-size: 1.8rem; margin: 0 0 10px 0; color: #333; }
        .result-desc { color: #666; margin-bottom: 20px; line-height: 1.5; }
        .ai-box {
            background: #f4f6ff;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
            margin-bottom: 25px;
            border-left: 4px solid var(--c-blue);
        }
        .ai-label { font-size: 0.75rem; color: #888; text-transform: uppercase; font-weight: bold; margin-bottom: 5px; display: block; }
        .ai-text { font-size: 0.9rem; color: #444; font-style: italic; }

        /* Canvas çº¸å±‘ */
        #confetti-canvas {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 101;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            main { flex-direction: column-reverse; overflow-y: auto; }
            .sidebar { width: 100%; height: 40%; border-right: none; border-top: 1px solid #eee; }
            .wheel-container { height: 60%; padding: 20px; }
            .canvas-wrapper { width: 60vmin; height: 60vmin; }
        }
    </style>
</head>
<body>

    <header>
        <h1>ğŸ¡ <span id="app-title">å¤šå½©å†’é™©å¤§è½¬ç›˜</span></h1>
        <button class="lang-switch" id="lang-btn">EN</button>
    </header>

    <main>
        <!-- å·¦ä¾§ï¼šç®¡ç†é¢æ¿ -->
        <div class="sidebar">
            <div class="category-tabs" id="category-tabs">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>

            <div class="add-box">
                <input type="text" id="new-activity-input" placeholder="è¾“å…¥æ–°æ´»åŠ¨...">
                <button id="add-btn">+</button>
            </div>

            <div class="activity-list" id="activity-list">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>

            <p class="selection-count" id="selection-count">å·²é€‰ 0/12</p>
        </div>

        <!-- ä¸­é—´ï¼šè½¬ç›˜ -->
        <div class="wheel-container">
            <div class="status-text" id="status-text">è½¬ç›˜æ—‹è½¬ä¸­...</div>
            
            <div class="canvas-wrapper">
                <!-- SVG æŒ‡é’ˆ -->
                <svg class="pointer" viewBox="0 0 54 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- æ‰‹æŒ‡éƒ¨åˆ† -->
                    <path d="M27 60L27 60" stroke="black" stroke-width="2"/>
                    <path d="M14 0C21.732 0 28 6.26801 28 14V34C28 34.5523 28.4477 35 29 35C29.5523 35 30 34.5523 30 34V18C30 15.7909 31.7909 14 34 14C36.2091 14 38 15.7909 38 18V34C38 34.5523 38.4477 35 39 35C39.5523 35 40 34.5523 40 34V20C40 17.7909 41.7909 16 44 16C46.2091 16 48 17.7909 48 20V42C48 51.9411 39.9411 60 30 60H24C14.0589 60 6 51.9411 6 42V14C6 6.26801 12.268 0 20 0H14Z" fill="#ff6b6b" stroke="white" stroke-width="3"/>
                    <circle cx="27" cy="62" r="2" fill="#333"/>
                </svg>

                <canvas id="wheel-canvas" width="1000" height="1000"></canvas>
                <div class="center-btn" id="center-btn">GO</div>
            </div>

            <button class="spin-btn-lg" id="spin-btn">å¼€å¯å†’é™©</button>
        </div>

        <!-- ç»“æœè¦†ç›–å±‚ -->
        <div class="result-overlay" id="result-overlay">
            <canvas id="confetti-canvas"></canvas>
            <div class="result-card">
                <span class="result-tag" id="res-tag">å¨±ä¹</span>
                <h2 class="result-title" id="res-title">çœ‹ä¸€åœºç”µå½±</h2>
                <p class="result-desc" id="res-desc">é€‰ä¸€éƒ¨è¯„åˆ†é«˜çš„ç»å…¸ç”µå½±ï¼Œå‡†å¤‡å¥½çˆ†ç±³èŠ±ï¼</p>
                <div class="ai-box">
                    <span class="ai-label">AI å»ºè®®</span>
                    <span class="ai-text" id="res-ai">ç”Ÿæ´»éœ€è¦ä¸€ç‚¹ä»ªå¼æ„Ÿï¼Œå°½æƒ…äº«å—è¿™2å°æ—¶å§ã€‚</span>
                </div>
                <button class="spin-btn-lg" style="font-size: 1rem; padding: 10px 30px;" id="reset-btn">æ–°çš„å†’é™©</button>
            </div>
        </div>
    </main>

    <script>
        /**
         * æ•°æ®æºä¸é…ç½®
         */
        const COLORS = {
            categories: ['#FFC3C3', '#A0E7E5', '#FBE7C6', '#E0BBE4'], // ç²‰(å¨±), è“(æ¢), é»„(å­¦), ç´«(ç¤¾)
            macaron: ['#FFC3C3', '#FFD1DC', '#A0E7E5', '#B4F8C8', '#FBE7C6', '#FFFCCB', '#E0BBE4', '#D7AEFB', '#FFB7B2', '#E2F0CB']
        };

        const TEXTS = {
            zh: {
                title: 'å¤šå½©å†’é™©å¤§è½¬ç›˜',
                categories: ['å¨±ä¹', 'æ¢ç´¢', 'å­¦ä¹ ', 'ç¤¾äº¤'],
                placeholder: 'è¾“å…¥æ–°æ´»åŠ¨æ ‡é¢˜...',
                count: (c, m) => `å·²é€‰ ${c}/${m}`,
                spin: 'å¼€å¯å†’é™©',
                spinning: 'è½¬ç›˜æ—‹è½¬ä¸­...',
                aiLabel: 'AI å»ºè®®',
                reset: 'æ–°çš„å†’é™©',
                go: 'GO',
                tips: {
                    maxCat: 'è¯¥åˆ†ç±»æ´»åŠ¨å·²æ»¡10ä¸ª',
                    maxTotal: 'æœ€å¤šåªèƒ½é€‰æ‹©12ä¸ªæ´»åŠ¨',
                    min: 'è¯·è‡³å°‘é€‰æ‹©1ä¸ªæ´»åŠ¨'
                },
                defaultData: [
                    // å¨±ä¹
                    [
                        { t: 'çœ‹ä¸€éƒ¨ç”µå½±', d: 'æ‰¾ä¸€éƒ¨è¯„åˆ†8.0ä»¥ä¸Šçš„ç»å…¸é«˜åˆ†ç”µå½±' },
                        { t: 'Kæ­Œ', d: 'å»KTVæˆ–è€…åœ¨å®¶é‡Œå°½æƒ…æ¬¢å”±' },
                        { t: 'ç©ç”µå­æ¸¸æˆ', d: 'å°è¯•ä¸€æ¬¾æ–°çš„Steamæ¸¸æˆæˆ–é€šå…³è€æ¸¸æˆ' },
                        { t: 'çƒ¹é¥ªæ–°èœ', d: 'è·Ÿç€æ•™ç¨‹åšä¸€é“ä»æœªå°è¯•è¿‡çš„èœç³»' },
                        { t: 'æ‹¼å›¾/ç§¯æœ¨', d: 'æ²‰æµ¸åœ¨1000å—æ‹¼å›¾æˆ–ä¹é«˜çš„ä¸–ç•Œé‡Œ' },
                        { t: 'æ³¡æ¾¡æ”¾æ¾', d: 'ç‚¹ä¸Šé¦™è–°èœ¡çƒ›ï¼Œåœ¨è¿™ä¸ªæ¾¡é‡Œæ³¡30åˆ†é’Ÿ' }
                    ],
                    // æ¢ç´¢
                    [
                        { t: 'åŸå¸‚æ¼«æ­¥', d: 'ä¸å¸¦ç›®çš„åœ°ï¼Œåœ¨åŸå¸‚é‡Œéšæœºè¡Œèµ°5å…¬é‡Œ' },
                        { t: 'æ¢è®¿æ–°åº—', d: 'å»ä¸€å®¶ä»æœªå»è¿‡çš„å’–å•¡é¦†æˆ–ä¹¦åº—' },
                        { t: 'æ‹æ‘„å¤•é˜³', d: 'æ‰¾ä¸ªé«˜åœ°ï¼Œè®°å½•ä»Šå¤©çš„æ—¥è½æ—¶åˆ»' },
                        { t: 'å¤œéª‘', d: 'éª‘å…±äº«å•è½¦åœ¨æ­¤åˆ»çš„è¡—é“ç©¿è¡Œ' },
                        { t: 'é€›åšç‰©é¦†', d: 'å»æœ€è¿‘çš„åšç‰©é¦†æˆ–è‰ºæœ¯å±•çœ‹ä¸€çœ‹' },
                        { t: 'å…¬å›­é‡é¤', d: 'å¸¦ä¸Šä¸‰æ˜æ²»ï¼Œå»å…¬å›­è‰åªèººå¹³' }
                    ],
                    // å­¦ä¹ 
                    [
                        { t: 'è¯»ä¸€æœ¬ä¹¦', d: 'é™ä¸‹å¿ƒæ¥é˜…è¯»30é¡µå®ä½“ä¹¦' },
                        { t: 'å­¦æ–°å•è¯', d: 'èƒŒè¯µ20ä¸ªæ–°è¯­è¨€çš„å•è¯æˆ–çŸ­è¯­' },
                        { t: 'çœ‹çºªå½•ç‰‡', d: 'äº†è§£è‡ªç„¶ã€å†å²æˆ–ç§‘æŠ€çš„æ–°çŸ¥è¯†' },
                        { t: 'å†¥æƒ³', d: 'è·Ÿéšå¼•å¯¼éŸ³é¢‘è¿›è¡Œ15åˆ†é’Ÿå†¥æƒ³' },
                        { t: 'å†™æ—¥è®°', d: 'è®°å½•å½“ä¸‹çš„å¿ƒæƒ…å’Œå¯¹æœªæ¥çš„æœŸè®¸' },
                        { t: 'æ•´ç†æˆ¿é—´', d: 'æ–­èˆç¦»ï¼Œæ‰”æ‰5ä»¶ä¸éœ€è¦çš„ä¸œè¥¿' }
                    ],
                    // ç¤¾äº¤
                    [
                        { t: 'ç»™æœ‹å‹æ‰“ç”µè¯', d: 'å’Œè®¸ä¹…æœªè§çš„è€å‹ç•…èŠ20åˆ†é’Ÿ' },
                        { t: 'å®¶åº­æ¸¸æˆå¤œ', d: 'ç»„ç»‡å®¶äººç©æ¡Œæ¸¸æˆ–æ‰‘å…‹' },
                        { t: 'å†™ä¿¡/æ˜ä¿¡ç‰‡', d: 'æ‰‹å†™ä¸€ä»½ç¥ç¦å¯„ç»™è¿œæ–¹çš„äºº' },
                        { t: 'èµç¾ä»–äºº', d: 'çœŸå¿ƒå®æ„åœ°å¤¸å¥–èº«è¾¹çš„ä¸‰ä¸ªäºº' },
                        { t: 'å‚åŠ èšä¼š', d: 'æŸ¥çœ‹åŒåŸæ´»åŠ¨ï¼ŒæŠ¥åå‚åŠ ä¸€ä¸ª' },
                        { t: 'åˆ†äº«ç¾é£Ÿ', d: 'åšäº†å¥½åƒçš„ï¼Œåˆ†ç»™é‚»å±…æˆ–åŒäº‹' }
                    ]
                ],
                aiSuggestions: [
                    "è¿™æ¬¡ä½“éªŒå¯èƒ½ä¼šæˆä¸ºä½ ç¾å¥½å›å¿†çš„ä¸€éƒ¨åˆ†ã€‚",
                    "å‹‡æ•¢è¸å‡ºè¿™ä¸€æ­¥ï¼Œä½ ä¼šå‘ç°æ–°å¤§é™†ã€‚",
                    "ä¸“æ³¨äºè¿‡ç¨‹çš„äº«å—ï¼Œè€Œä¸ä»…ä»…æ˜¯ç»“æœã€‚",
                    "è¿™æ­£æ˜¯æ”¾æ¾èº«å¿ƒã€å……ç”µçš„æœ€ä½³æ—¶æœºã€‚",
                    "å«ä¸Šä¼™ä¼´ä¸€èµ·ï¼Œå¿«ä¹ä¼šåŠ å€å“¦ï¼"
                ]
            },
            en: {
                title: 'Colorful Adventure Wheel',
                categories: ['Entertainment', 'Exploration', 'Learning', 'Social'],
                placeholder: 'Enter activity title...',
                count: (c, m) => `Selected ${c}/${m}`,
                spin: 'Start Adventure',
                spinning: 'Spinning...',
                aiLabel: 'AI Suggestion',
                reset: 'New Adventure',
                go: 'GO',
                tips: {
                    maxCat: 'Max 10 activities per category',
                    maxTotal: 'Max 12 activities total',
                    min: 'Select at least 1 activity'
                },
                defaultData: [
                    // Entertainment
                    [
                        { t: 'Watch a Movie', d: 'Find a classic movie with high rating' },
                        { t: 'Karaoke', d: 'Sing your heart out at home or KTV' },
                        { t: 'Video Games', d: 'Try a new indie game or finish an old one' },
                        { t: 'Cook New Dish', d: 'Follow a recipe you never tried before' },
                        { t: 'Puzzle/Lego', d: 'Immerse yourself in a 1000-piece puzzle' },
                        { t: 'Bubble Bath', d: 'Light candles and relax for 30 mins' }
                    ],
                    // Exploration
                    [
                        { t: 'City Walk', d: 'Walk 5km in the city without destination' },
                        { t: 'Visit New Shop', d: 'Go to a cafe or bookstore you never visited' },
                        { t: 'Sunset Photo', d: 'Find a high spot and capture the sunset' },
                        { t: 'Night Ride', d: 'Ride a bike through the streets tonight' },
                        { t: 'Museum', d: 'Visit the nearest museum or art gallery' },
                        { t: 'Picnic', d: 'Take sandwiches to the park lawn' }
                    ],
                    // Learning
                    [
                        { t: 'Read a Book', d: 'Read 30 pages of a physical book' },
                        { t: 'Learn Words', d: 'Memorize 20 words of a new language' },
                        { t: 'Documentary', d: 'Learn about nature, history or tech' },
                        { t: 'Meditation', d: 'Do a 15 min guided meditation' },
                        { t: 'Journaling', d: 'Write down feelings and future goals' },
                        { t: 'Declutter', d: 'Throw away 5 things you do not need' }
                    ],
                    // Social
                    [
                        { t: 'Call a Friend', d: 'Chat with an old friend for 20 mins' },
                        { t: 'Game Night', d: 'Organize board games with family' },
                        { t: 'Write Letter', d: 'Handwrite a card to someone far away' },
                        { t: 'Compliment', d: 'Sincerely praise 3 people around you' },
                        { t: 'Join Party', d: 'Check local events and join one' },
                        { t: 'Share Food', d: 'Share your cooking with neighbors' }
                    ]
                ],
                aiSuggestions: [
                    "This experience might become a great memory.",
                    "Be brave, you will discover something new.",
                    "Focus on the process, not just the result.",
                    "Perfect time to recharge your energy.",
                    "Bring a friend, happiness doubles!"
                ]
            }
        };

        // å…¨å±€çŠ¶æ€
        let state = {
            lang: 'zh',
            currentCatIdx: 0,
            activities: JSON.parse(JSON.stringify(TEXTS.zh.defaultData)), // æ·±æ‹·è´
            selected: [] // å­˜å‚¨ { catIdx, itemIdx, title, desc, color }
        };

        // åˆå§‹åŒ–é€‰ä¸­ (é»˜è®¤æ¯ç±»é€‰å‰1ä¸ªï¼Œå…±4ä¸ª)
        for(let i=0; i<4; i++) {
            if(state.activities[i][0]) {
                state.selected.push({
                    catIdx: i,
                    itemIdx: 0,
                    title: state.activities[i][0].t,
                    desc: state.activities[i][0].d,
                    color: COLORS.categories[i]
                });
                state.activities[i][0].selected = true;
            }
        }

        /**
         * DOM å…ƒç´ è·å–
         */
        const els = {
            appTitle: document.getElementById('app-title'),
            langBtn: document.getElementById('lang-btn'),
            tabs: document.getElementById('category-tabs'),
            list: document.getElementById('activity-list'),
            input: document.getElementById('new-activity-input'),
            addBtn: document.getElementById('add-btn'),
            count: document.getElementById('selection-count'),
            wheelCanvas: document.getElementById('wheel-canvas'),
            spinBtn: document.getElementById('spin-btn'),
            centerBtn: document.getElementById('center-btn'),
            statusText: document.getElementById('status-text'),
            overlay: document.getElementById('result-overlay'),
            resTag: document.getElementById('res-tag'),
            resTitle: document.getElementById('res-title'),
            resDesc: document.getElementById('res-desc'),
            resAi: document.getElementById('res-ai'),
            resLabel: document.querySelector('.ai-label'),
            resetBtn: document.getElementById('reset-btn'),
            confettiCanvas: document.getElementById('confetti-canvas'),
            inputPlaceholder: document.getElementById('new-activity-input')
        };

        /**
         * æ ¸å¿ƒé€»è¾‘ï¼šUI æ¸²æŸ“
         */
        function renderUI() {
            const txt = TEXTS[state.lang];
            
            // æ–‡æœ¬æ›´æ–°
            els.appTitle.innerText = txt.title;
            els.spinBtn.innerText = txt.spin;
            els.centerBtn.innerText = txt.go;
            els.resetBtn.innerText = txt.reset;
            els.statusText.innerText = txt.spinning;
            els.resLabel.innerText = txt.aiLabel;
            els.inputPlaceholder.placeholder = txt.placeholder;

            // æ¸²æŸ“ Tabs
            els.tabs.innerHTML = '';
            txt.categories.forEach((cat, idx) => {
                const btn = document.createElement('button');
                btn.className = `tab-btn ${idx === state.currentCatIdx ? 'active' : ''}`;
                btn.innerText = cat;
                btn.style.setProperty('--c-primary', COLORS.categories[idx]);
                btn.onclick = () => {
                    state.currentCatIdx = idx;
                    renderUI();
                };
                els.tabs.appendChild(btn);
            });

            // æ¸²æŸ“åˆ—è¡¨
            els.list.innerHTML = '';
            const currentItems = state.activities[state.currentCatIdx];
            currentItems.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = `activity-item ${item.selected ? 'selected' : ''}`;
                div.style.setProperty('--c-primary', COLORS.categories[state.currentCatIdx]);
                div.innerHTML = `
                    <div class="item-check"></div>
                    <div>
                        <div style="font-weight:bold">${item.t}</div>
                        <div style="font-size:0.8rem;color:#999">${item.d || ''}</div>
                    </div>
                `;
                div.onclick = () => toggleSelection(state.currentCatIdx, idx);
                els.list.appendChild(div);
            });

            // æ›´æ–°è®¡æ•°ä¸æŒ‰é’®çŠ¶æ€
            els.count.innerText = txt.count(state.selected.length, 12);
            
            const canSpin = state.selected.length > 0;
            els.spinBtn.disabled = !canSpin;
            els.centerBtn.style.opacity = canSpin ? '1' : '0.5';
            els.centerBtn.style.pointerEvents = canSpin ? 'auto' : 'none';

            // ç»˜åˆ¶è½¬ç›˜
            drawWheel();
        }

        // åˆ‡æ¢é€‰ä¸­çŠ¶æ€
        function toggleSelection(catIdx, itemIdx) {
            const item = state.activities[catIdx][itemIdx];
            const txt = TEXTS[state.lang];

            if (item.selected) {
                item.selected = false;
                // ä» selected æ•°ç»„ç§»é™¤
                state.selected = state.selected.filter(s => !(s.catIdx === catIdx && s.itemIdx === itemIdx));
            } else {
                if (state.selected.length >= 12) {
                    alert(txt.tips.maxTotal);
                    return;
                }
                item.selected = true;
                state.selected.push({
                    catIdx: catIdx,
                    itemIdx: itemIdx,
                    title: item.t,
                    desc: item.d,
                    color: COLORS.categories[catIdx]
                });
            }
            renderUI();
        }

        // æ·»åŠ æ–°æ´»åŠ¨
        els.addBtn.onclick = () => {
            const val = els.input.value.trim();
            const txt = TEXTS[state.lang];
            const currentList = state.activities[state.currentCatIdx];

            if (!val) return;
            if (currentList.length >= 10) {
                alert(txt.tips.maxCat);
                return;
            }

            currentList.push({ t: val, d: '', selected: false }); // é»˜è®¤ä¸é€‰ä¸­
            els.input.value = '';
            // è‡ªåŠ¨é€‰ä¸­æ–°æ·»åŠ çš„ï¼Ÿæ ¹æ®éœ€æ±‚æ˜¯"å½’ç±»"ï¼Œè¿™é‡Œé€»è¾‘æ˜¯æ·»åŠ åç”¨æˆ·æ‰‹åŠ¨é€‰
            renderUI();
        };

        // åˆ‡æ¢è¯­è¨€
        els.langBtn.onclick = () => {
             // ç®€æ˜“åˆ‡æ¢ï¼Œé‡ç½®æ•°æ®ä»¥åŒ¹é…è¯­è¨€ï¼ˆå®é™…é¡¹ç›®å¯èƒ½éœ€è¦æ˜ å°„IDï¼‰
             const nextLang = state.lang === 'zh' ? 'en' : 'zh';
             if(confirm(state.lang === 'zh' ? 'åˆ‡æ¢è¯­è¨€å°†é‡ç½®å½“å‰é€‰æ‹©ï¼Œç¡®å®šå—ï¼Ÿ' : 'Switching language will reset selections, sure?')) {
                 state.lang = nextLang;
                 state.activities = JSON.parse(JSON.stringify(TEXTS[state.lang].defaultData));
                 state.selected = [];
                 els.langBtn.innerText = nextLang === 'zh' ? 'EN' : 'ä¸­æ–‡';
                 renderUI();
             }
        };

        /**
         * è½¬ç›˜ç»˜åˆ¶é€»è¾‘
         */
        const ctx = els.wheelCanvas.getContext('2d');
        const W = 1000; // Canvas å†…éƒ¨åˆ†è¾¨ç‡
        let currentRotation = 0; // å½“å‰æ—‹è½¬è§’åº¦

        function drawWheel() {
            ctx.clearRect(0, 0, W, W);
            const cx = W/2, cy = W/2, r = W/2 - 20;
            const count = state.selected.length;

            if (count === 0) {
                // ç©ºçŠ¶æ€
                ctx.beginPath();
                ctx.arc(cx, cy, r, 0, Math.PI * 2);
                ctx.fillStyle = '#eee';
                ctx.fill();
                return;
            }

            const arcSize = (Math.PI * 2) / count;
            
            // ä¸ºäº†è®©ç¬¬0é¡¹å±…ä¸­å¯¹ç€é¡¶éƒ¨æŒ‡é’ˆï¼Œæˆ‘ä»¬éœ€è¦åç§»
            // é»˜è®¤ Canvas 0åº¦åœ¨3ç‚¹é’Ÿã€‚è¦è®©0åº¦åœ¨12ç‚¹é’Ÿï¼Œéœ€æ—‹è½¬-90åº¦ (-PI/2)
            // æ­¤å¤–ï¼Œä¸ºäº†è®©æ‰‡å½¢"ä¸­å¿ƒ"å¯¹å‡†12ç‚¹ï¼Œè€Œä¸æ˜¯æ‰‡å½¢"è¾¹ç¼˜"å¯¹å‡†12ç‚¹ï¼Œè¿˜éœ€æ—‹è½¬ -arcSize/2
            const startOffset = -Math.PI/2 - arcSize/2;

            ctx.save();
            // åº”ç”¨å½“å‰ç‰©ç†æ—‹è½¬
            ctx.translate(cx, cy);
            ctx.rotate(currentRotation * Math.PI / 180);
            ctx.translate(-cx, -cy);

            for (let i = 0; i < count; i++) {
                const angle = startOffset + i * arcSize;
                
                // æ‰‡å½¢
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.arc(cx, cy, r, angle, angle + arcSize);
                ctx.closePath();
                
                // é¢œè‰²å¾ªç¯
                // å¦‚æœæ˜¯åŒç±»ç›¸è¿ç¨å¾®è°ƒæ•´ä¸€ä¸‹è‰²å·®ï¼Œè¿™é‡Œç›´æ¥ç”¨å¤§åˆ†ç±»é¢œè‰²
                // éœ€æ±‚ï¼šé©¬å¡é¾™è‰²ç³»åŒºåˆ†ã€‚
                // æ–¹æ¡ˆï¼šä½¿ç”¨å¤§ç±»çš„é¢œè‰²ï¼Œä½†ä¸ºäº†åŒºåˆ†ç›¸é‚»å—ï¼Œå¯ä»¥å åŠ è½»å¾®é€æ˜åº¦æˆ–äº®åº¦å˜åŒ–ï¼Œ
                // æˆ–è€…ç›´æ¥ä½¿ç”¨ macaron è°ƒè‰²æ¿å¾ªç¯ï¼Œå¿½ç•¥åˆ†ç±»è‰²
                // éœ€æ±‚ï¼šæ¯ä¸ªåˆ†åŒºæ˜¾ç¤ºæ´»åŠ¨æ ‡é¢˜ã€‚ç»“æœå¡ç‰‡æ˜¾ç¤ºåˆ†ç±»è‰²ã€‚
                // è¿™é‡Œçš„è§†è§‰æ•ˆæœæˆ‘ä»¬ç”¨é¢„è®¾çš„ macaron æ•°ç»„å¾ªç¯ï¼Œçœ‹èµ·æ¥æ›´ä¸°å¯Œ
                ctx.fillStyle = COLORS.macaron[i % COLORS.macaron.length];
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 4;
                ctx.stroke();

                // æ–‡å­—
                ctx.save();
                ctx.translate(cx, cy);
                ctx.rotate(angle + arcSize / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#555";
                ctx.font = "bold 40px 'Segoe UI', sans-serif";
                const text = state.selected[i].title;
                // æˆªæ–­æ–‡å­—
                let displayTxt = text;
                if (text.length > 8) displayTxt = text.substring(0, 7) + '..';
                ctx.fillText(displayTxt, r - 50, 10);
                ctx.restore();
            }
            ctx.restore();
        }

        /**
         * è½¬ç›˜ç‰©ç†é€»è¾‘
         */
        let isSpinning = false;
        
        function startSpin() {
            if (isSpinning || state.selected.length === 0) return;
            isSpinning = true;
            els.spinBtn.disabled = true;
            els.centerBtn.style.pointerEvents = 'none';
            els.statusText.classList.add('show');

            // 1. éšæœºé€‰å®šç›®æ ‡
            const count = state.selected.length;
            const targetIndex = Math.floor(Math.random() * count);
            const targetItem = state.selected[targetIndex];

            // 2. è®¡ç®—ç›®æ ‡è§’åº¦
            // å½“å‰æŒ‡é’ˆåœ¨é¡¶éƒ¨ (12ç‚¹)ã€‚
            // æˆ‘ä»¬ç»˜åˆ¶æ—¶ï¼ŒIndex 0 çš„ä¸­å¿ƒå®é™…ä¸Šæ˜¯åœ¨ -90 åº¦ä½ç½® (canvasåæ ‡ç³»ï¼ŒåŠ ä¸Šæˆ‘ä»¬çš„ startOffset å)
            // å½“ rotation = 0 æ—¶ï¼ŒIndex 0 å¯¹åº”æŒ‡é’ˆã€‚
            // å½“ rotation = -arcSize (é€†æ—¶é’ˆè½¬ä¸€ä¸ªæ ¼)ï¼ŒIndex 1 å¯¹åº”æŒ‡é’ˆã€‚
            // ç›®æ ‡è§’åº¦ Rotation = - (Index * 360/count)
            // ä¸ºäº†å¤šè½¬å‡ åœˆï¼Œæˆ‘ä»¬åŠ ä¸Š N * 360
            // ä½†å› ä¸º canvas æ—‹è½¬æ­£å‘æ˜¯é¡ºæ—¶é’ˆï¼Œä¸ºäº†è®©çœ‹èµ·æ¥åƒé‚£ä¸ªæ–¹å‘è½¬ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šæ–¹å‘ã€‚
            // å‡è®¾æˆ‘ä»¬é¡ºæ—¶é’ˆæ—‹è½¬è½¬ç›˜ (angle å¢åŠ )ã€‚
            // å¢åŠ  360 åº¦ï¼Œå›åˆ°åŸç‚¹ã€‚
            // è¦è®© Index 1 åˆ°è¾¾é¡¶éƒ¨ï¼Œè½¬ç›˜éœ€è¦é€†æ—¶é’ˆè½¬ (Angle å‡å°) æˆ–è€… é¡ºæ—¶é’ˆè½¬ (Angle å¢åŠ ) ä¸€å¤§åœˆå‡å»ä¸€æ ¼ã€‚
            // é€»è¾‘: ç›®æ ‡è§’åº¦ = (360 - (targetIndex * 360 / count)) % 360 + randomOffset?
            // ç®€åŒ–ï¼šæœ€ç»ˆè§’åº¦ = TotalRotations * 360 + (360 - targetIndex * (360/count))
            // æ­¤æ—¶ Index 0 è½¬äº† (360 - idx*step)ï¼Œåˆšå¥½è®© Index idx è½¬åˆ° 0 çš„ä½ç½®ã€‚

            const sectorAngle = 360 / count;
            const targetRotationBase = (360 - (targetIndex * sectorAngle)); 
            
            // æ·»åŠ  5 åœˆ (5 * 360)
            const extraSpins = 5 * 360; 
            // æœ€ç»ˆç›®æ ‡æ€»è§’åº¦
            const finalAngle = extraSpins + targetRotationBase;
            
            // é‡ç½®å½“å‰è§’åº¦åˆ° 0-360 èŒƒå›´å†…ï¼Œé¿å…æ•°å­—è¿‡å¤§
            currentRotation = currentRotation % 360;
            
            // åŠ¨ç”»å‚æ•°
            // éœ€æ±‚ï¼š1såŠ é€Ÿï¼Œ3såŒ€é€Ÿï¼Œ2så‡é€Ÿã€‚ æ€»å…±6sã€‚
            // è·ç¦» S = S_acc + S_const + S_dec
            // è®¾æœ€å¤§é€Ÿåº¦ä¸º V (åº¦/å¸§ æˆ– åº¦/msï¼Œè¿™é‡Œä½¿ç”¨ requestAnimationFrameï¼Œå‡è®¾60fps)
            // æ—¶é—´ï¼šT1=1s, T2=3s, T3=2s
            // S_acc = 0.5 * V * T1
            // S_const = V * T2
            // S_dec = 0.5 * V * T3
            // Total S = 0.5V + 3V + 1V = 4.5V (è¿™é‡Œçš„å•ä½æ˜¯ V*ç§’)
            // æ‰€ä»¥ V_per_sec = TotalDistance / 4.5
            // æˆ‘ä»¬éœ€è¦è®© TotalDistance æ¥è¿‘ finalAngleï¼Œä½†è¦å‡å»å½“å‰èµ·å§‹è§’åº¦ã€‚
            
            let distanceNeed = finalAngle - currentRotation;
            // ç¡®ä¿è·ç¦»æ˜¯æ­£æ•°ä¸”è¶³å¤Ÿå¤§
            if (distanceNeed < extraSpins) distanceNeed += 360;

            const vMaxPerSec = distanceNeed / 4.5; 
            
            // åŠ¨ç”»å¾ªç¯å˜é‡
            let startTime = null;

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = (timestamp - startTime) / 1000; // ç§’

                let vCurrent = 0; // å½“å‰é€Ÿåº¦ (åº¦/ç§’)
                let dCurrent = 0; // å½“å‰è¿™ä¸€å¸§åº”è¯¥åœ¨çš„ä½ç½® (éœ€ç§¯åˆ†è®¡ç®—ï¼Œç¨å¾®å¤æ‚)

                // ç®€å•çš„ç§¯åˆ†å¤ªéº»çƒ¦ï¼Œæˆ‘ä»¬æ ¹æ®æ—¶é—´è®¡ç®—å½“å‰åº”è¯¥èµ°è¿‡çš„æ€»è·ç¦»çš„æ¯”ä¾‹? 
                // ä¸è¡Œï¼Œé‚£ä¸ªä¸æ˜¯åŒ€é€Ÿã€‚
                // æˆ‘ä»¬ç›´æ¥è®¡ç®—åœ¨å½“å‰æ—¶é—´ç‚¹ï¼Œåº”è¯¥èµ°è¿‡çš„ æ€»è·ç¦» S(t)
                
                let s = 0;
                
                if (elapsed <= 1) {
                    // åŠ é€Ÿé˜¶æ®µ: s = 0.5 * a * t^2.  a = vMax / 1.
                    const a = vMaxPerSec;
                    s = 0.5 * a * elapsed * elapsed;
                } else if (elapsed <= 4) {
                    // åŒ€é€Ÿé˜¶æ®µ: s = s1 + v * (t - 1)
                    const s1 = 0.5 * vMaxPerSec; // 1ç§’æœ«çš„è·ç¦»
                    s = s1 + vMaxPerSec * (elapsed - 1);
                } else if (elapsed <= 6) {
                    // å‡é€Ÿé˜¶æ®µ: s = s_total - 0.5 * a_dec * (6 - t)^2
                    // åå‘æ€è€ƒï¼šè·ç¦»ç»ˆç‚¹è¿˜æœ‰å¤šå°‘ã€‚ å‡é€Ÿæ˜¯åŠ é€Ÿçš„é€†è¿‡ç¨‹ã€‚
                    // å‰©ä½™æ—¶é—´ t_rem = 6 - elapsed.
                    // å‰©ä½™è·ç¦» s_rem = 0.5 * (vMax / 2) * t_rem^2 ??? 
                    // å‡é€Ÿåº¦ a_dec = vMax / 2.
                    const t_rem = 6 - elapsed;
                    s = distanceNeed - (0.5 * (vMaxPerSec/2) * t_rem * t_rem);
                } else {
                    // ç»“æŸ
                    s = distanceNeed;
                }

                // æ›´æ–°å½“å‰è§’åº¦
                const renderAngle = (currentRotation + s); // currentRotation æ˜¯åˆå§‹å€¼
                
                // ç»˜åˆ¶
                // æ³¨æ„ï¼šdrawWheel ä½¿ç”¨å…¨å±€å˜é‡ currentRotationï¼Œè¿™é‡Œæˆ‘ä»¬ä¸´æ—¶è¦†ç›–å®ƒæˆ–è€…é‡æ„ drawWheel
                // ç®€å•ç‚¹ï¼šdrawWheel ä¾èµ–ä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬æ›´æ–°é‚£ä¸ªå˜é‡
                const tempRotation = renderAngle;
                
                // æ¸²æŸ“
                const finalRenderAngle = tempRotation;
                
                // è¿™é‡Œæœ‰ä¸ªå°Hackï¼ŒdrawWheelç”¨çš„æ˜¯å…¨å±€currentRotation
                // æˆ‘ä»¬ä¸ä¿®æ”¹å…¨å±€currentRotationçš„åŸºæœ¬å€¼ï¼Œè€Œæ˜¯è®©drawWheelç”»çš„æ—¶å€™ç”¨è¿™ä¸ªå€¼
                const realCtxDrawValue = currentRotation; // ä¿å­˜åˆå§‹å€¼
                currentRotation = finalRenderAngle; 
                drawWheel();
                currentRotation = realCtxDrawValue; // æ¢å¤åˆå§‹å€¼ä»¥ä¾¿ä¸‹ä¸€å¸§è®¡ç®—åŸºäºåˆå§‹å€¼

                if (elapsed < 6) {
                    requestAnimationFrame(animate);
                } else {
                    // åŠ¨ç”»ç»“æŸ
                    currentRotation = finalRenderAngle % 360; // å›ºåŒ–æœ€ç»ˆè§’åº¦
                    drawWheel(); // æœ€ç»ˆç»˜åˆ¶
                    isSpinning = false;
                    els.statusText.classList.remove('show');
                    showResult(targetItem);
                }
            }

            requestAnimationFrame(animate);
        }
        
        // ç»‘å®šä¸¤ä¸ªæŒ‰é’®
        els.spinBtn.onclick = startSpin;
        els.centerBtn.onclick = startSpin;

        // æ˜¾ç¤ºç»“æœ
        function showResult(item) {
            const txt = TEXTS[state.lang];
            
            // æ•°æ®å¡«å……
            els.resTag.innerText = txt.categories[item.catIdx];
            els.resTag.style.backgroundColor = item.color;
            els.resTag.style.color = '#555'; // å¦‚æœèƒŒæ™¯å¤ªæµ…ï¼Œæ–‡å­—æ·±ä¸€ç‚¹ï¼Œæˆ–è€…ç»´æŒç™½è‰²
            
            els.resTitle.innerText = item.title;
            els.resDesc.innerText = item.desc;
            
            // éšæœº AI å»ºè®®
            const rndAi = txt.aiSuggestions[Math.floor(Math.random() * txt.aiSuggestions.length)];
            els.resAi.innerText = rndAi;

            // æ˜¾ç¤º
            els.overlay.classList.add('active');
            
            // çº¸å±‘ç‰¹æ•ˆ
            startConfetti();
        }

        // é‡ç½®
        els.resetBtn.onclick = () => {
            els.overlay.classList.remove('active');
            stopConfetti();
            els.spinBtn.disabled = false;
            els.centerBtn.style.pointerEvents = 'auto';
        }

        /**
         * çº¸å±‘æ•ˆæœ (ç®€æ˜“ç‰ˆ)
         */
        let confettiLoop;
        const particles = [];
        
        function startConfetti() {
            const canvas = els.confettiCanvas;
            const ctxC = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            for(let i=0; i<100; i++) {
                particles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 20,
                    vy: (Math.random() - 1) * 20,
                    color: COLORS.macaron[Math.floor(Math.random()*COLORS.macaron.length)],
                    size: Math.random() * 8 + 4,
                    life: 1
                });
            }

            function update() {
                ctxC.clearRect(0,0, canvas.width, canvas.height);
                for(let i=0; i<particles.length; i++) {
                    let p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.5; // é‡åŠ›
                    p.life -= 0.01;
                    
                    ctxC.globalAlpha = p.life;
                    ctxC.fillStyle = p.color;
                    ctxC.fillRect(p.x, p.y, p.size, p.size);
                }
                // ç§»é™¤æ­»æ‰çš„ç²’å­
                let alive = false;
                for(let i=particles.length-1; i>=0; i--) {
                    if(particles[i].life <= 0) particles.splice(i, 1);
                    else alive = true;
                }
                
                if(alive) confettiLoop = requestAnimationFrame(update);
                else ctxC.clearRect(0,0,canvas.width,canvas.height);
            }
            update();
        }

        function stopConfetti() {
            cancelAnimationFrame(confettiLoop);
            particles.length = 0;
            const canvas = els.confettiCanvas;
            const ctxC = canvas.getContext('2d');
            ctxC.clearRect(0,0,canvas.width,canvas.height);
        }

        // çª—å£å¤§å°è°ƒæ•´é€‚é…
        window.addEventListener('resize', () => {
            drawWheel();
        });

        // åˆå§‹åŒ–
        renderUI();

    </script>
</body>
</html>